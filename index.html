<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Attendance Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body class="bg-light">

<div class="container py-5">
  <h2 class="text-center mb-4">Employee Attendance</h2>
  
  <form id="attendanceForm">
    <div class="mb-3">
      <label for="name" class="form-label">Employee Name (Scan QR or Input)</label>
      <input type="text" class="form-control" id="name" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Type</label>
      <select class="form-select" id="type" required>
        <option value="">-- Select --</option>
        <option value="Check-in">Check-in</option>
        <option value="Check-out">Check-out</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary w-100">Submit Attendance</button>
  </form>

  <div id="successMessage" class="alert alert-success mt-3 d-none">Submitted successfully!</div>
  <div id="qr-reader" class="mt-5"></div>
</div>

<script>
  const form = document.getElementById('attendanceForm');
  const successMsg = document.getElementById('successMessage');

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const type = document.getElementById('type').value;

    const payload = {
      name: name,
      type: type
    };

    await fetch("https://script.google.com/macros/s/AKfycbwaEuvLfF8CjYr3Z5yiRU2hSYiKrWoL7RK3Bc15aJFMw-xqrzlAbi9F5REgO0s0EONV/exec", {
      method: "POST",
      body: JSON.stringify(payload),
      headers: {
        "Content-Type": "application/json"
      }
    });

    successMsg.classList.remove("d-none");
    form.reset();
    setTimeout(() => successMsg.classList.add("d-none"), 3000);
  });

  // QR Code Scanner
  const qrReader = new Html5Qrcode("qr-reader");
  qrReader.start(
    { facingMode: "environment" },
    {
      fps: 10,
      qrbox: 250
    },
    (decodedText) => {
      document.getElementById("name").value = decodedText;
      qrReader.stop();
    }
  );
</script>

</body>
</html>
