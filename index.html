<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Attendance Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body class="bg-light">

<div class="container py-5">
  <h2 class="text-center mb-4">Employee Attendance</h2>
  
  <form id="attendanceForm">
    <div class="mb-3">
      <label for="name" class="form-label">Employee Name (Scan QR or Input)</label>
      <input type="text" class="form-control" id="name" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Type</label>
      <select class="form-select" id="type" required>
        <option value="">-- Select --</option>
        <option value="Check-in">Check-in</option>
        <option value="Check-out">Check-out</option>
      </select>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-between mb-3">
      <button type="button" class="btn btn-secondary" onclick="startQRScanner()">Scan QR</button>
      <button type="submit" class="btn btn-primary">Submit Attendance</button>
    </div>
  </form>

  <div id="successMessage" class="alert alert-success mt-3 d-none">✅ Submitted successfully!</div>
  <div id="errorMessage" class="alert alert-danger mt-3 d-none">❌ Failed to submit. Please try again.</div>
  <div id="qr-reader" class="mt-4"></div>
</div>

<script>
  const form = document.getElementById('attendanceForm');
  const successMsg = document.getElementById('successMessage');
  const errorMsg = document.getElementById('errorMessage');
  const qrReaderContainer = document.getElementById("qr-reader");

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const type = document.getElementById('type').value;

    const payload = {
      name: name,
      type: type
    };

    try {
      const res = await fetch("https://script.google.com/macros/s/AKfycbzEv68o7eX71gEH0QC8xOJBksTfOqpGkvsHLLZ_rGk/dev", {
        method: "POST",
        body: JSON.stringify(payload),
        headers: {
          "Content-Type": "application/json"
        }
      });

      if (!res.ok) throw new Error("Failed");

      successMsg.classList.remove("d-none");
      errorMsg.classList.add("d-none");
      form.reset();
      setTimeout(() => successMsg.classList.add("d-none"), 3000);
    } catch (error) {
      successMsg.classList.add("d-none");
      errorMsg.classList.remove("d-none");
    }
  });

  let qrReader;
  function startQRScanner() {
    qrReader = new Html5Qrcode("qr-reader");
    qrReader.start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: 250
      },
      (decodedText) => {
        document.getElementById("name").value = decodedText;
        qrReader.stop();
      }
    );
  }
</script>

</body>
</html>
